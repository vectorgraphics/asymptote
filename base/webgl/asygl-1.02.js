/*@license
 AsyGL: Render Bezier patches and triangles via subdivision with WebGL.
  Copyright 2019-2025: John C. Bowman and Supakorn "Jamie" Rassameemasmuang
  University of Alberta

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
/*@license for gl-matrix mat3 and mat4 functions:
Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.*/
(()=>{"use strict";var t=1e-6,e="undefined"!=typeof Float32Array?Float32Array:Array;function i(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function n(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,e,i){var n=e[0],s=e[1],r=e[2],a=e[3],h=e[4],o=e[5],l=e[6],c=e[7],d=e[8],m=e[9],f=e[10],u=e[11],p=e[12],v=e[13],g=e[14],x=e[15],w=i[0],M=i[1],T=i[2],b=i[3];return t[0]=w*n+M*h+T*d+b*p,t[1]=w*s+M*o+T*m+b*v,t[2]=w*r+M*l+T*f+b*g,t[3]=w*a+M*c+T*u+b*x,w=i[4],M=i[5],T=i[6],b=i[7],t[4]=w*n+M*h+T*d+b*p,t[5]=w*s+M*o+T*m+b*v,t[6]=w*r+M*l+T*f+b*g,t[7]=w*a+M*c+T*u+b*x,w=i[8],M=i[9],T=i[10],b=i[11],t[8]=w*n+M*h+T*d+b*p,t[9]=w*s+M*o+T*m+b*v,t[10]=w*r+M*l+T*f+b*g,t[11]=w*a+M*c+T*u+b*x,w=i[12],M=i[13],T=i[14],b=i[15],t[12]=w*n+M*h+T*d+b*p,t[13]=w*s+M*o+T*m+b*v,t[14]=w*r+M*l+T*f+b*g,t[15]=w*a+M*c+T*u+b*x,t}function r(t,e,i,n,s,r,a){var h=1/(i-e),o=1/(s-n),l=1/(r-a);return t[0]=2*r*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*o,t[6]=0,t[7]=0,t[8]=(i+e)*h,t[9]=(s+n)*o,t[10]=(a+r)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r*2*l,t[15]=0,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var a=function(t,e,i,n,s,r,a){var h=1/(e-i),o=1/(n-s),l=1/(r-a);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*h,t[13]=(s+n)*o,t[14]=(a+r)*l,t[15]=1,t};function h(){var t=new e(9);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}!function(){const e={canvasWidth:0,canvasHeight:0,absolute:!1,minBound:[0,0,0],maxBound:[0,0,0],orthographic:!1,angleOfView:0,initialZoom:0,viewportShift:[0,0],viewportMargin:[0,0],background:[],zoomFactor:0,zoomPinchFactor:0,zoomPinchCap:0,zoomStep:0,shiftHoldDistance:0,shiftWaitTime:0,vibrateTime:0,ibl:!1,webgl2:!1,imageURL:"",image:"",Transform:[],Centers:[],canvasWidth0:0,canvasHeight0:0,zoom0:0,embedded:!1,canvas:null};globalThis.document.asy=e;const o=e;let l,c,d,m,f,u,p,v=[],g=[],x=[],w=0,M=2;const T=1/3,b=Math.acos(-1),R=b/180,E=Math.ceil(1-Math.log2(Number.EPSILON));let A,y,L,I,N,U,S,V,O,_,B,P,D,C,F,z,X,H,G=i(),W=i(),k=i(),j=i(),Y=h(),$=h(),q=i(),K=i(),Z={x:0,y:0,z:0},Q={x:0,y:0},J={xmin:0,xmax:0,ymin:0,ymax:0,zmin:0,zmax:0},tt=!0,et=0,it=!1,nt=null,st=null,rt=[],at=[],ht=[],ot=[],lt=null,ct=null,dt=null;class mt{constructor(t,e,i,n,s,r){this.diffuse=t,this.emissive=e,this.specular=i,this.shininess=n,this.metallic=s,this.fresnel0=r}setUniform(t,e){let i=i=>l.getUniformLocation(t,"Materials["+e+"]."+i);l.uniform4fv(i("diffuse"),new Float32Array(this.diffuse)),l.uniform4fv(i("emissive"),new Float32Array(this.emissive)),l.uniform4fv(i("specular"),new Float32Array(this.specular)),l.uniform4f(i("parameters"),this.shininess,this.metallic,this.fresnel0,0)}}class ft{constructor(t,e){this.direction=t,this.color=e}setUniform(t,e){const i=i=>l.getUniformLocation(t,"Lights["+e+"]."+i);l.uniform3fv(i("direction"),new Float32Array(this.direction)),l.uniform3fv(i("color"),new Float32Array(this.color))}}function ut(t=!1){const e=l.getParameter(l.MAX_VERTEX_UNIFORM_VECTORS);f=Math.floor((e-14)/4),M=Math.min(Math.max(M,x.length),f);const i=["NORMAL"],n=["NORMAL","COLOR","TRANSPARENT"];t&&(i.push("USE_IBL"),n.push("USE_IBL")),Ve=Ht(["WIDTH"]),Oe=Ht(i),_e=Ht(["NORMAL","COLOR"]),Be=Ht(n)}function pt(){l.deleteProgram(Be),l.deleteProgram(_e),l.deleteProgram(Oe),l.deleteProgram(Ve)}function vt(){const t=window.top.document,e=o.webgl2?t.asygl2[c]:t.asygl[c],i={gl:l,nlights:g.length,Nmaterials:M,maxMaterials:f,pixelShader:Ve,materialShader:Oe,colorShader:_e,transparentShader:Be};Object.assign(e,i)}function gt(t,e){let i;return o.webgl2&&(i=t.getContext("webgl2",{alpha:e}),o.embedded&&!i)?(o.webgl2=!1,o.ibl=!1,xt(!1),null):(i||(o.webgl2=!1,o.ibl=!1,i=t.getContext("webgl",{alpha:e})),i||alert("Could not initialize WebGL"),i)}function xt(t=!0){if(o.ibl&&(o.webgl2=!0),c=o.background[3]<1,o.embedded){const e=window.top.document;t&&(m=o.canvas.getContext("2d")),d=o.webgl2?e.offscreen2:e.offscreen,d||(d=e.createElement("canvas"),o.webgl2?e.offscreen2=d:e.offscreen=d),o.webgl2?e.asygl2||(e.asygl2=Array(2)):e.asygl||(e.asygl=Array(2)),function(){let t=window.top.document;const e=o.webgl2?t.asygl2:t.asygl;if(e[c]&&e[c].gl)!function(){const t=window.top.document;let e=o.webgl2?t.asygl2[c]:t.asygl[c];l=e.gl,w=e.nlights,M=e.Nmaterials,f=e.maxMaterials,Ve=e.pixelShader,Oe=e.materialShader,_e=e.colorShader,Be=e.transparentShader}(),(g.length!=w||Math.min(x.length,f)>M)&&(ut(),vt());else{const e=gt(d,c);if(!e)return;l=e,ut(),o.webgl2?t.asygl2[c]={}:t.asygl[c]={},vt()}}()}else l=gt(o.canvas,c),ut();_=l.getExtension("OES_element_index_uint"),B=l.TRIANGLES,P=new bt(l.POINTS),D=new bt(l.LINES),C=new bt,F=new bt,z=new bt,X=new bt}function wt(t,e,i,n=[]){let s=o.webgl2?"300 es":"100",r=Array(...n),a=[["nlights",0==et?g.length:0],["Nmaterials",M]],h=[["int","Nlights",Math.max(g.length,1)]];o.webgl2&&r.push("WEBGL2"),o.ibl&&a.push(["ROUGHNESS_STEP_COUNT",8..toFixed(2)]);const l=a.map(t=>`#define ${t[0]} ${t[1]}`).join("\n"),c=r.map(t=>`#define ${t}`).join("\n"),d=h.map(t=>`const ${t[0]} ${t[1]}=${t[2]};`).join("\n"),m=`#version ${s}\n${[].map(t=>`#extension ${t}: enable`).join("\n")}\n${c}\n${d}\n${l}\n\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n  \n${e}\n  `;let f=t.createShader(i);return t.shaderSource(f,m),t.compileShader(f),t.getShaderParameter(f,t.COMPILE_STATUS)?f:(alert(t.getShaderInfoLog(f)),null)}function Mt(t,e,i,n=l.ARRAY_BUFFER){return t.length>0&&(0==e&&(e=l.createBuffer(),i=!0),l.bindBuffer(n,e),i&&l.bufferData(n,t,l.STATIC_DRAW)),e}function Tt(t,e,i=t.indices){if(0==t.indices.length)return;let n=e!=Ve;!function(t,e){let i=e==Ve;l.useProgram(e),l.enableVertexAttribArray(Dt),i&&l.enableVertexAttribArray(Xt);let n=!i&&g.length>0;if(n&&l.enableVertexAttribArray(Ct),l.enableVertexAttribArray(Ft),e.projViewMatUniform=l.getUniformLocation(e,"projViewMat"),e.viewMatUniform=l.getUniformLocation(e,"viewMat"),e.normMatUniform=l.getUniformLocation(e,"normMat"),e.orthographicUniform=l.getUniformLocation(e,"orthographic"),(e==_e||e==Be)&&l.enableVertexAttribArray(zt),n)for(let t=0;t<g.length;++t)g[t].setUniform(e,t);for(let i=0;i<t.materials.length;++i)t.materials[i].setUniform(e,i);l.uniformMatrix4fv(e.projViewMatUniform,!1,j),l.uniformMatrix4fv(e.viewMatUniform,!1,k),l.uniformMatrix3fv(e.normMatUniform,!1,Y),l.uniform1i(e.orthographicUniform,1,o.orthographic)}(t,e),null!=ct&&(l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,dt),l.uniform1i(l.getUniformLocation(e,"reflBRDFSampler"),0),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,ct),l.uniform1i(l.getUniformLocation(e,"diffuseSampler"),1),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,lt),l.uniform1i(l.getUniformLocation(e,"reflImgSampler"),2));let s=tt||t.partial||!t.rendered;t.verticesBuffer=Mt(new Float32Array(t.vertices),t.verticesBuffer,s),l.vertexAttribPointer(Dt,3,l.FLOAT,!1,n?24:16,0),n?g.length>0&&l.vertexAttribPointer(Ct,3,l.FLOAT,!1,24,12):l.vertexAttribPointer(Xt,1,l.FLOAT,!1,16,12),t.materialsBuffer=Mt(new Int16Array(t.materialIndices),t.materialsBuffer,s),l.vertexAttribPointer(Ft,1,l.SHORT,!1,2,0),e!=_e&&e!=Be||(t.colorsBuffer=Mt(new Float32Array(t.colors),t.colorsBuffer,s),l.vertexAttribPointer(zt,4,l.FLOAT,!0,0,0)),t.indicesBuffer=Mt(_?new Uint32Array(i):new Uint16Array(i),t.indicesBuffer,s,l.ELEMENT_ARRAY_BUFFER),t.rendered=!0,l.drawElements(n?et?l.LINES:t.type:l.POINTS,i.length,_?l.UNSIGNED_INT:l.UNSIGNED_SHORT,0)}class bt{constructor(t=B){this.type=t,this.verticesBuffer=0,this.materialsBuffer=0,this.colorsBuffer=0,this.indicesBuffer=0,this.rendered=!1,this.partial=!1,this.vertices=[],this.materialIndices=[],this.colors=[],this.indices=[],this.materials=[],this.materialTable=[],this.nvertices=0,this.clear()}clear(){this.vertices.length=0,this.materialIndices=[],this.colors=[],this.indices=[],this.nvertices=0,this.materials=[],this.materialTable=[]}vertex(t,e){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.vertices.push(e[0]),this.vertices.push(e[1]),this.vertices.push(e[2]),this.materialIndices.push(H),this.nvertices++}Vertex(t,e,i=[0,0,0,0]){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.vertices.push(e[0]),this.vertices.push(e[1]),this.vertices.push(e[2]),this.materialIndices.push(H),this.colors.push(i[0]),this.colors.push(i[1]),this.colors.push(i[2]),this.colors.push(i[3]),this.nvertices++}vertex0(t,e){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.vertices.push(e),this.materialIndices.push(H),this.nvertices++}iVertex(t,e,i,n,s=[0,0,0,0]){let r=6*t;this.vertices[r]=e[0],this.vertices[r+1]=e[1],this.vertices[r+2]=e[2],this.vertices[r+3]=i[0],this.vertices[r+4]=i[1],this.vertices[r+5]=i[2],this.materialIndices[t]=H;let a=4*t;this.colors[a]=s[0],this.colors[a+1]=s[1],this.colors[a+2]=s[2],this.colors[a+3]=s[3],n&&this.indices.push(t)}append(t){Rt(this.vertices,t.vertices),Rt(this.materialIndices,t.materialIndices),Rt(this.colors,t.colors),function(t,e,i){let n=t.length,s=e.length;t.length+=e.length;for(let r=0;r<s;++r)t[n+r]=e[r]+i}(this.indices,t.indices,this.nvertices),this.nvertices+=t.nvertices}}function Rt(t,e){let i=t.length,n=e.length;t.length+=n;for(let s=0;s<n;++s)t[i+s]=e[s]}class Et{constructor(){this.data=new bt,this.Onscreen=!1,this.m=[]}offscreen(t){let e=j,i=t[0],n=i[0],s=i[1],r=i[2],a=1/(e[3]*n+e[7]*s+e[11]*r+e[15]);this.x=this.X=(e[0]*n+e[4]*s+e[8]*r+e[12])*a,this.y=this.Y=(e[1]*n+e[5]*s+e[9]*r+e[13])*a;for(let i=1,n=t.length;i<n;++i){let n=t[i],s=n[0],r=n[1],a=n[2],h=1/(e[3]*s+e[7]*r+e[11]*a+e[15]),o=(e[0]*s+e[4]*r+e[8]*a+e[12])*h,l=(e[1]*s+e[5]*r+e[9]*a+e[13])*h;o<this.x?this.x=o:o>this.X&&(this.X=o),l<this.y?this.y=l:l>this.Y&&(this.Y=l)}return(this.X<-1.01||this.x>1.01||this.Y<-1.01||this.y>1.01)&&(this.Onscreen=!1,!0)}T(t){let e=this.c[0],i=this.c[1],n=this.c[2],s=t[0]-e,r=t[1]-i,a=t[2]-n;return[s*Y[0]+r*Y[3]+a*Y[6]+e,s*Y[1]+r*Y[4]+a*Y[7]+i,s*Y[2]+r*Y[5]+a*Y[8]+n]}Tcorners(t,e){return[this.T(t),this.T([t[0],t[1],e[2]]),this.T([t[0],e[1],t[2]]),this.T([t[0],e[1],e[2]]),this.T([e[0],t[1],t[2]]),this.T([e[0],t[1],e[2]]),this.T([e[0],e[1],t[2]]),this.T(e)]}setMaterial(t,e){null==t.materialTable[this.MaterialIndex]&&(t.materials.length>=M&&(t.partial=!0,e()),t.materialTable[this.MaterialIndex]=t.materials.length,t.materials.push(x[this.MaterialIndex])),H=t.materialTable[this.MaterialIndex]}render(){let t;var e,i;if(this.setMaterialIndex(),0==this.CenterIndex?(e=this.Min,i=this.Max,t=[e,[e[0],e[1],i[2]],[e[0],i[1],e[2]],[e[0],i[1],i[2]],[i[0],e[1],e[2]],[i[0],e[1],i[2]],[i[0],i[1],e[2]],i]):(this.c=o.Centers[this.CenterIndex-1],t=this.Tcorners(this.Min,this.Max)),this.offscreen(t))return this.data.clear(),void this.notRendered();let n,s=this.controlpoints;if(0==this.CenterIndex){if(!tt&&this.Onscreen)return void this.append();n=s}else{let t=s.length;n=Array(t);for(let e=0;e<t;++e)n[e]=this.T(s[e])}let r=o.orthographic?1:this.Min[2]/o.maxBound[2],a=.75*Math.hypot(r*(J.xmax-J.xmin),r*(J.ymax-J.ymin))/V;this.res2=a*a,this.Epsilon=.1*a,this.data.clear(),this.notRendered(),this.Onscreen=!0,this.process(n)}}function At(t,e){let i=t[0],n=t.length;for(let s=1;s<n;++s)i=e(i,t[s]);return i}class yt extends Et{constructor(t,e,i,n=null,s=null,r=null){var a,h;super(),this.controlpoints=t,this.CenterIndex=e,this.MaterialIndex=i,this.color=n,this.Min=s,this.Max=r;const o=t.length;if(n){let t=n[0][3]+n[1][3]+n[2][3];this.transparent=16==o||4==o?t+n[3][3]<4:t<3}else this.transparent=x[i].diffuse[3]<1;this.vertex=this.transparent?this.data.Vertex.bind(this.data):this.data.vertex.bind(this.data);let l=this.L2norm2(this.controlpoints),c=Math.sqrt(1e3*Number.EPSILON*l);this.epsilon=l*Number.EPSILON,this.Min=null!==(a=this.Min)&&void 0!==a?a:this.Bounds(this.controlpoints,Math.min,c),this.Max=null!==(h=this.Max)&&void 0!==h?h:this.Bounds(this.controlpoints,Math.max,c)}setMaterialIndex(){this.transparent?this.setMaterial(z,He):this.color?this.setMaterial(F,ze):this.setMaterial(C,Fe)}cornerbound(t,e){let i=e(t[0],t[3]);return i=e(i,t[12]),e(i,t[15])}controlbound(t,e){let i=e(t[1],t[2]);return i=e(i,t[4]),i=e(i,t[5]),i=e(i,t[6]),i=e(i,t[7]),i=e(i,t[8]),i=e(i,t[9]),i=e(i,t[10]),i=e(i,t[11]),i=e(i,t[13]),e(i,t[14])}bound(t,e,i,n,s){if(i=e(i,this.cornerbound(t,e)),e(-1,1)*(i-this.controlbound(t,e))>=-n||0==s)return i;--s,n*=2;const r=new Gt(t[0],t[1],t[2],t[3]),a=new Gt(t[4],t[5],t[6],t[7]),h=new Gt(t[8],t[9],t[10],t[11]),o=new Gt(t[12],t[13],t[14],t[15]),l=new Gt(t[0],t[4],t[8],t[12]),c=new Gt(r.m0,a.m0,h.m0,o.m0),d=new Gt(r.m3,a.m3,h.m3,o.m3),m=new Gt(r.m5,a.m5,h.m5,o.m5),f=new Gt(r.m4,a.m4,h.m4,o.m4),u=new Gt(r.m2,a.m2,h.m2,o.m2),p=new Gt(t[3],t[7],t[11],t[15]),v=[t[0],r.m0,r.m3,r.m5,l.m0,c.m0,d.m0,m.m0,l.m3,c.m3,d.m3,m.m3,l.m5,c.m5,d.m5,m.m5];i=this.bound(v,e,i,n,s);const g=[l.m5,c.m5,d.m5,m.m5,l.m4,c.m4,d.m4,m.m4,l.m2,c.m2,d.m2,m.m2,t[12],o.m0,o.m3,o.m5];i=this.bound(g,e,i,n,s);const x=[m.m5,f.m5,u.m5,p.m5,m.m4,f.m4,u.m4,p.m4,m.m2,f.m2,u.m2,p.m2,o.m5,o.m4,o.m2,t[15]];i=this.bound(x,e,i,n,s);const w=[r.m5,r.m4,r.m2,t[3],m.m0,f.m0,u.m0,p.m0,m.m3,f.m3,u.m3,p.m3,m.m5,f.m5,u.m5,p.m5];return this.bound(w,e,i,n,s)}cornerboundtri(t,e){let i=e(t[0],t[6]);return e(i,t[9])}controlboundtri(t,e){let i=e(t[1],t[2]);return i=e(i,t[3]),i=e(i,t[4]),i=e(i,t[5]),i=e(i,t[7]),e(i,t[8])}boundtri(t,e,i,n,s){if(i=e(i,this.cornerboundtri(t,e)),e(-1,1)*(i-this.controlboundtri(t,e))>=-n||0==s)return i;--s,n*=2;let r=new kt(t),a=[r.l003,r.l102,r.l012,r.l201,r.l111,r.l021,r.l300,r.l210,r.l120,r.l030];i=this.boundtri(a,e,i,n,s);let h=[r.l300,r.r102,r.r012,r.r201,r.r111,r.r021,r.r300,r.r210,r.r120,r.r030];i=this.boundtri(h,e,i,n,s);let o=[r.l030,r.u102,r.u012,r.u201,r.u111,r.u021,r.r030,r.u210,r.u120,r.u030];i=this.boundtri(o,e,i,n,s);let l=[r.r030,r.u201,r.r021,r.u102,r.c111,r.r012,r.l030,r.l120,r.l210,r.l300];return this.boundtri(l,e,i,n,s)}Bounds(t,e,i){let n=Array(3),s=t.length,r=Array(s);for(let a=0;a<3;++a){for(let e=0;e<s;++e)r[e]=t[e][a];n[a]=16==s?this.bound(r,e,r[0],i,E):10==s?this.boundtri(r,e,r[0],i,E):At(r,e)}return[n[0],n[1],n[2]]}L2norm2(t){let e=t[0],i=0,n=t.length;for(let s=1;s<n;++s)i=Math.max(i,Yt([t[s][0]-e[0],t[s][1]-e[1],t[s][2]-e[2]]));return i}processTriangle(t){let e=t[0],i=t[1],n=t[2],s=jt(qt([i[0]-e[0],i[1]-e[1],i[2]-e[2]],[n[0]-e[0],n[1]-e[1],n[2]-e[2]]));if(!this.offscreen([e,i,n])){let t,r,a;this.color?(t=this.data.Vertex(e,s,this.color[0]),r=this.data.Vertex(i,s,this.color[1]),a=this.data.Vertex(n,s,this.color[2])):(t=this.vertex(e,s),r=this.vertex(i,s),a=this.vertex(n,s)),0==et?(this.data.indices.push(t),this.data.indices.push(r),this.data.indices.push(a)):(this.data.indices.push(t),this.data.indices.push(r),this.data.indices.push(r),this.data.indices.push(a),this.data.indices.push(a),this.data.indices.push(t)),this.append()}}processQuad(t){let e=t[0],i=t[1],n=t[2],s=t[3],r=qt([i[0]-e[0],i[1]-e[1],i[2]-e[2]],[n[0]-i[0],n[1]-i[1],n[2]-i[2]]),a=qt([n[0]-s[0],n[1]-s[1],n[2]-s[2]],[s[0]-e[0],s[1]-e[1],s[2]-e[2]]),h=jt([r[0]+a[0],r[1]+a[1],r[2]+a[2]]);if(!this.offscreen([e,i,n,s])){let t,r,a,o;this.color?(t=this.data.Vertex(e,h,this.color[0]),r=this.data.Vertex(i,h,this.color[1]),a=this.data.Vertex(n,h,this.color[2]),o=this.data.Vertex(s,h,this.color[3])):(t=this.vertex(e,h),r=this.vertex(i,h),a=this.vertex(n,h),o=this.vertex(s,h)),0==et?(this.data.indices.push(t),this.data.indices.push(r),this.data.indices.push(a),this.data.indices.push(t),this.data.indices.push(a),this.data.indices.push(o)):(this.data.indices.push(t),this.data.indices.push(r),this.data.indices.push(r),this.data.indices.push(a),this.data.indices.push(a),this.data.indices.push(o),this.data.indices.push(o),this.data.indices.push(t)),this.append()}}curve(t,e,i,n,s){new Ut([t[e],t[i],t[n],t[s]],0,H,this.Min,this.Max).render()}process(t){if(this.transparent&&1!=et&&(H=this.color?-1-H:1+H),10==t.length)return this.process3(t);if(3==t.length)return this.processTriangle(t);if(4==t.length)return this.processQuad(t);if(1==et)return this.curve(t,0,4,8,12),this.curve(t,12,13,14,15),this.curve(t,15,11,7,3),void this.curve(t,3,2,1,0);let e=t[0],i=t[3],n=t[12],s=t[15],r=this.normal(i,t[2],t[1],e,t[4],t[8],n);Yt(r)<this.epsilon&&(r=this.normal(i,t[2],t[1],e,t[13],t[14],s),Yt(r)<this.epsilon&&(r=this.normal(s,t[11],t[7],i,t[4],t[8],n)));let a=this.normal(e,t[4],t[8],n,t[13],t[14],s);Yt(a)<this.epsilon&&(a=this.normal(e,t[4],t[8],n,t[11],t[7],i),Yt(a)<this.epsilon&&(a=this.normal(i,t[2],t[1],e,t[13],t[14],s)));let h=this.normal(n,t[13],t[14],s,t[11],t[7],i);Yt(h)<this.epsilon&&(h=this.normal(n,t[13],t[14],s,t[2],t[1],e),Yt(h)<this.epsilon&&(h=this.normal(e,t[4],t[8],n,t[11],t[7],i)));let o=this.normal(s,t[11],t[7],i,t[2],t[1],e);if(Yt(o)<this.epsilon&&(o=this.normal(s,t[11],t[7],i,t[4],t[8],n),Yt(o)<this.epsilon&&(o=this.normal(n,t[13],t[14],s,t[2],t[1],e))),this.color){let l=this.color[0],c=this.color[1],d=this.color[2],m=this.color[3],f=this.data.Vertex(e,r,l),u=this.data.Vertex(n,a,c),p=this.data.Vertex(s,h,d),v=this.data.Vertex(i,o,m);this.Render(t,f,u,p,v,e,n,s,i,!1,!1,!1,!1,l,c,d,m)}else{let l=this.vertex(e,r),c=this.vertex(n,a),d=this.vertex(s,h),m=this.vertex(i,o);this.Render(t,l,c,d,m,e,n,s,i,!1,!1,!1,!1)}this.data.indices.length>0&&this.append()}append(){this.transparent?z.append(this.data):this.color?F.append(this.data):C.append(this.data)}notRendered(){this.transparent?z.rendered=!1:this.color?F.rendered=!1:C.rendered=!1}Render(t,e,i,n,s,r,a,h,o,l,c,d,m,f=null,u=null,p=null,v=null){let g=this.Distance(t);if(g[0]<this.res2&&g[1]<this.res2)this.offscreen([r,a,h])||(0==et?(this.data.indices.push(e),this.data.indices.push(i),this.data.indices.push(n)):(this.data.indices.push(e),this.data.indices.push(i),this.data.indices.push(i),this.data.indices.push(n))),this.offscreen([r,h,o])||(0==et?(this.data.indices.push(e),this.data.indices.push(n),this.data.indices.push(s)):(this.data.indices.push(n),this.data.indices.push(s),this.data.indices.push(s),this.data.indices.push(e)));else{if(this.offscreen(t))return;let x=t[0],w=t[3],M=t[12],T=t[15];if(g[0]<this.res2){let g=new Wt(x,t[1],t[2],w),b=new Wt(t[4],t[5],t[6],t[7]),R=new Wt(t[8],t[9],t[10],t[11]),E=new Wt(M,t[13],t[14],T),A=[x,g.m0,g.m3,g.m5,t[4],b.m0,b.m3,b.m5,t[8],R.m0,R.m3,R.m5,M,E.m0,E.m3,E.m5],y=[g.m5,g.m4,g.m2,w,b.m5,b.m4,b.m2,t[7],R.m5,R.m4,R.m2,t[11],E.m5,E.m4,E.m2,T],L=this.normal(A[12],A[13],A[14],A[15],A[11],A[7],A[3]);Yt(L)<=this.epsilon&&(L=this.normal(A[12],A[13],A[14],A[15],A[2],A[1],A[0]),Yt(L)<=this.epsilon&&(L=this.normal(A[0],A[4],A[8],A[12],A[11],A[7],A[3])));let I=this.normal(y[3],y[2],y[1],y[0],y[4],y[8],y[12]);Yt(I)<=this.epsilon&&(I=this.normal(y[3],y[2],y[1],y[0],y[13],y[14],y[15]),Yt(I)<=this.epsilon&&(I=this.normal(y[15],y[11],y[7],y[3],y[4],y[8],y[12])));let N=this.Epsilon,U=[.5*(a[0]+h[0]),.5*(a[1]+h[1]),.5*(a[2]+h[2])];if(!c)if(c=te(M,t[13],t[14],T)<this.res2){let t=jt(this.differential(y[12],y[8],y[4],y[0]));U=[U[0]-N*t[0],U[1]-N*t[1],U[2]-N*t[2]]}else U=A[15];let S=[.5*(o[0]+r[0]),.5*(o[1]+r[1]),.5*(o[2]+r[2])];if(!m)if(m=te(x,t[1],t[2],w)<this.res2){let t=jt(this.differential(A[3],A[7],A[11],A[15]));S=[S[0]-N*t[0],S[1]-N*t[1],S[2]-N*t[2]]}else S=y[0];if(f){let t=Array(4),g=Array(4);for(let e=0;e<4;++e)t[e]=.5*(u[e]+p[e]),g[e]=.5*(v[e]+f[e]);let x=this.data.Vertex(U,L,t),w=this.data.Vertex(S,I,g);this.Render(A,e,i,x,w,r,a,U,S,l,c,!1,m,f,u,t,g),this.Render(y,w,x,n,s,S,U,h,o,!1,c,d,m,g,t,p,v)}else{let t=this.vertex(U,L),f=this.vertex(S,I);this.Render(A,e,i,t,f,r,a,U,S,l,c,!1,m),this.Render(y,f,t,n,s,S,U,h,o,!1,c,d,m)}return}if(g[1]<this.res2){let g=new Wt(x,t[4],t[8],M),b=new Wt(t[1],t[5],t[9],t[13]),R=new Wt(t[2],t[6],t[10],t[14]),E=new Wt(w,t[7],t[11],T),A=[x,t[1],t[2],w,g.m0,b.m0,R.m0,E.m0,g.m3,b.m3,R.m3,E.m3,g.m5,b.m5,R.m5,E.m5],y=[g.m5,b.m5,R.m5,E.m5,g.m4,b.m4,R.m4,E.m4,g.m2,b.m2,R.m2,E.m2,M,t[13],t[14],T],L=this.normal(A[0],A[4],A[8],A[12],A[13],A[14],A[15]);Yt(L)<=this.epsilon&&(L=this.normal(A[0],A[4],A[8],A[12],A[11],A[7],A[3]),Yt(L)<=this.epsilon&&(L=this.normal(A[3],A[2],A[1],A[0],A[13],A[14],A[15])));let I=this.normal(y[15],y[11],y[7],y[3],y[2],y[1],y[0]);Yt(I)<=this.epsilon&&(I=this.normal(y[15],y[11],y[7],y[3],y[4],y[8],y[12]),Yt(I)<=this.epsilon&&(I=this.normal(y[12],y[13],y[14],y[15],y[2],y[1],y[0])));let N=this.Epsilon,U=[.5*(r[0]+a[0]),.5*(r[1]+a[1]),.5*(r[2]+a[2])];if(!l)if(l=te(x,t[4],t[8],M)<this.res2){let t=jt(this.differential(y[0],y[1],y[2],y[3]));U=[U[0]-N*t[0],U[1]-N*t[1],U[2]-N*t[2]]}else U=A[12];let S=[.5*(h[0]+o[0]),.5*(h[1]+o[1]),.5*(h[2]+o[2])];if(!d)if(d=te(T,t[11],t[7],w)<this.res2){let t=jt(this.differential(A[15],A[14],A[13],A[12]));S=[S[0]-N*t[0],S[1]-N*t[1],S[2]-N*t[2]]}else S=y[3];if(f){let t=Array(4),g=Array(4);for(let e=0;e<4;++e)t[e]=.5*(f[e]+u[e]),g[e]=.5*(p[e]+v[e]);let x=this.data.Vertex(U,L,t),w=this.data.Vertex(S,I,g);this.Render(A,e,x,w,s,r,U,S,o,l,!1,d,m,f,t,g,v),this.Render(y,x,i,n,w,U,a,h,S,l,c,d,!1,t,u,p,g)}else{let t=this.vertex(U,L),f=this.vertex(S,I);this.Render(A,e,t,f,s,r,U,S,o,l,!1,d,m),this.Render(y,t,i,n,f,U,a,h,S,l,c,d,!1)}return}let b=new Wt(x,t[1],t[2],w),R=new Wt(t[4],t[5],t[6],t[7]),E=new Wt(t[8],t[9],t[10],t[11]),A=new Wt(M,t[13],t[14],T),y=new Wt(x,t[4],t[8],M),L=new Wt(b.m0,R.m0,E.m0,A.m0),I=new Wt(b.m3,R.m3,E.m3,A.m3),N=new Wt(b.m5,R.m5,E.m5,A.m5),U=new Wt(b.m4,R.m4,E.m4,A.m4),S=new Wt(b.m2,R.m2,E.m2,A.m2),V=new Wt(w,t[7],t[11],T),O=[x,b.m0,b.m3,b.m5,y.m0,L.m0,I.m0,N.m0,y.m3,L.m3,I.m3,N.m3,y.m5,L.m5,I.m5,N.m5],_=[y.m5,L.m5,I.m5,N.m5,y.m4,L.m4,I.m4,N.m4,y.m2,L.m2,I.m2,N.m2,M,A.m0,A.m3,A.m5],B=[N.m5,U.m5,S.m5,V.m5,N.m4,U.m4,S.m4,V.m4,N.m2,U.m2,S.m2,V.m2,A.m5,A.m4,A.m2,T],P=[b.m5,b.m4,b.m2,w,N.m0,U.m0,S.m0,V.m0,N.m3,U.m3,S.m3,V.m3,N.m5,U.m5,S.m5,V.m5],D=O[15],C=this.normal(O[0],O[4],O[8],O[12],O[13],O[14],O[15]);Yt(C)<this.epsilon&&(C=this.normal(O[0],O[4],O[8],O[12],O[11],O[7],O[3]),Yt(C)<this.epsilon&&(C=this.normal(O[3],O[2],O[1],O[0],O[13],O[14],O[15])));let F=this.normal(_[12],_[13],_[14],_[15],_[11],_[7],_[3]);Yt(F)<this.epsilon&&(F=this.normal(_[12],_[13],_[14],_[15],_[2],_[1],_[0]),Yt(F)<this.epsilon&&(F=this.normal(_[0],_[4],_[8],_[12],_[11],_[7],_[3])));let z=this.normal(B[15],B[11],B[7],B[3],B[2],B[1],B[0]);Yt(z)<this.epsilon&&(z=this.normal(B[15],B[11],B[7],B[3],B[4],B[8],B[12]),Yt(z)<this.epsilon&&(z=this.normal(B[12],B[13],B[14],B[15],B[2],B[1],B[0])));let X=this.normal(P[3],P[2],P[1],P[0],P[4],P[8],P[12]);Yt(X)<this.epsilon&&(X=this.normal(P[3],P[2],P[1],P[0],P[13],P[14],P[15]),Yt(X)<this.epsilon&&(X=this.normal(P[15],P[11],P[7],P[3],P[4],P[8],P[12])));let H=this.normal(B[3],B[2],B[1],D,B[4],B[8],B[12]),G=this.Epsilon,W=[.5*(r[0]+a[0]),.5*(r[1]+a[1]),.5*(r[2]+a[2])];if(!l)if(l=te(x,t[4],t[8],M)<this.res2){let t=jt(this.differential(_[0],_[1],_[2],_[3]));W=[W[0]-G*t[0],W[1]-G*t[1],W[2]-G*t[2]]}else W=O[12];let k=[.5*(a[0]+h[0]),.5*(a[1]+h[1]),.5*(a[2]+h[2])];if(!c)if(c=te(M,t[13],t[14],T)<this.res2){let t=jt(this.differential(B[12],B[8],B[4],B[0]));k=[k[0]-G*t[0],k[1]-G*t[1],k[2]-G*t[2]]}else k=_[15];let j=[.5*(h[0]+o[0]),.5*(h[1]+o[1]),.5*(h[2]+o[2])];if(!d)if(d=te(T,t[11],t[7],w)<this.res2){let t=jt(this.differential(P[15],P[14],P[13],P[12]));j=[j[0]-G*t[0],j[1]-G*t[1],j[2]-G*t[2]]}else j=B[3];let Y=[.5*(o[0]+r[0]),.5*(o[1]+r[1]),.5*(o[2]+r[2])];if(!m)if(m=te(x,t[1],t[2],w)<this.res2){let t=jt(this.differential(O[3],O[7],O[11],O[15]));Y=[Y[0]-G*t[0],Y[1]-G*t[1],Y[2]-G*t[2]]}else Y=P[0];if(f){let t=Array(4),g=Array(4),x=Array(4),w=Array(4),M=Array(4);for(let e=0;e<4;++e)t[e]=.5*(f[e]+u[e]),g[e]=.5*(u[e]+p[e]),x[e]=.5*(p[e]+v[e]),w[e]=.5*(v[e]+f[e]),M[e]=.5*(t[e]+x[e]);let T=this.data.Vertex(W,C,t),b=this.data.Vertex(k,F,g),R=this.data.Vertex(j,z,x),E=this.data.Vertex(Y,X,w),A=this.data.Vertex(D,H,M);this.Render(O,e,T,A,E,r,W,D,Y,l,!1,!1,m,f,t,M,w),this.Render(_,T,i,b,A,W,a,k,D,l,c,!1,!1,t,u,g,M),this.Render(B,A,b,n,R,D,k,h,j,!1,c,d,!1,M,g,p,x),this.Render(P,E,A,R,s,Y,D,j,o,!1,!1,d,m,w,M,x,v)}else{let t=this.vertex(W,C),f=this.vertex(k,F),u=this.vertex(j,z),p=this.vertex(Y,X),v=this.vertex(D,H);this.Render(O,e,t,v,p,r,W,D,Y,l,!1,!1,m),this.Render(_,t,i,f,v,W,a,k,D,l,c,!1,!1),this.Render(B,v,f,n,u,D,k,h,j,!1,c,d,!1),this.Render(P,p,v,u,s,Y,D,j,o,!1,!1,d,m)}}}process3(t){if(1==et)return this.curve(t,0,1,3,6),this.curve(t,6,7,8,9),void this.curve(t,9,5,2,0);let e=t[0],i=t[6],n=t[9],s=this.normal(n,t[5],t[2],e,t[1],t[3],i),r=this.normal(e,t[1],t[3],i,t[7],t[8],n),a=this.normal(i,t[7],t[8],n,t[5],t[2],e);if(this.color){let h=this.color[0],o=this.color[1],l=this.color[2],c=this.data.Vertex(e,s,h),d=this.data.Vertex(i,r,o),m=this.data.Vertex(n,a,l);this.Render3(t,c,d,m,e,i,n,!1,!1,!1,h,o,l)}else{let h=this.vertex(e,s),o=this.vertex(i,r),l=this.vertex(n,a);this.Render3(t,h,o,l,e,i,n,!1,!1,!1)}this.data.indices.length>0&&this.append()}Render3(t,e,i,n,s,r,a,h,o,l,c=null,d=null,m=null){if(this.Distance3(t)<this.res2)this.offscreen([s,r,a])||(0==et?(this.data.indices.push(e),this.data.indices.push(i),this.data.indices.push(n)):(this.data.indices.push(e),this.data.indices.push(i),this.data.indices.push(i),this.data.indices.push(n),this.data.indices.push(n),this.data.indices.push(e)));else{if(this.offscreen(t))return;let f=t[0],u=t[1],p=t[2],v=t[3],g=t[4],x=t[5],w=t[6],M=t[7],T=t[8],b=t[9],R=[.5*(b[0]+x[0]),.5*(b[1]+x[1]),.5*(b[2]+x[2])],E=[.5*(b[0]+T[0]),.5*(b[1]+T[1]),.5*(b[2]+T[2])],A=[.5*(x[0]+p[0]),.5*(x[1]+p[1]),.5*(x[2]+p[2])],y=[.5*(T[0]+g[0]),.5*(T[1]+g[1]),.5*(T[2]+g[2])],L=[.5*(T[0]+M[0]),.5*(T[1]+M[1]),.5*(T[2]+M[2])],I=[.5*(p[0]+g[0]),.5*(p[1]+g[1]),.5*(p[2]+g[2])],N=[.5*(p[0]+f[0]),.5*(p[1]+f[1]),.5*(p[2]+f[2])],U=[.5*(g[0]+v[0]),.5*(g[1]+v[1]),.5*(g[2]+v[2])],S=[.5*(M[0]+w[0]),.5*(M[1]+w[1]),.5*(M[2]+w[2])],V=[.5*(f[0]+u[0]),.5*(f[1]+u[1]),.5*(f[2]+u[2])],O=[.5*(u[0]+v[0]),.5*(u[1]+v[1]),.5*(u[2]+v[2])],_=[.5*(v[0]+w[0]),.5*(v[1]+w[1]),.5*(v[2]+w[2])],B=[.5*(R[0]+A[0]),.5*(R[1]+A[1]),.5*(R[2]+A[2])],P=[.5*(E[0]+L[0]),.5*(E[1]+L[1]),.5*(E[2]+L[2])],D=[.5*(A[0]+N[0]),.5*(A[1]+N[1]),.5*(A[2]+N[2])],C=[.5*y[0]+.25*(g[0]+u[0]),.5*y[1]+.25*(g[1]+u[1]),.5*y[2]+.25*(g[2]+u[2])],F=[.5*(L[0]+S[0]),.5*(L[1]+S[1]),.5*(L[2]+S[2])],z=[.5*I[0]+.25*(g[0]+M[0]),.5*I[1]+.25*(g[1]+M[1]),.5*I[2]+.25*(g[2]+M[2])],X=[.25*(x[0]+g[0])+.5*U[0],.25*(x[1]+g[1])+.5*U[1],.25*(x[2]+g[2])+.5*U[2]],H=[.5*(V[0]+O[0]),.5*(V[1]+O[1]),.5*(V[2]+O[2])],G=[.5*(O[0]+_[0]),.5*(O[1]+_[1]),.5*(O[2]+_[2])],W=[.5*(z[0]+H[0]),.5*(z[1]+H[1]),.5*(z[2]+H[2])],k=[.5*(z[0]+G[0]),.5*(z[1]+G[1]),.5*(z[2]+G[2])],j=[.5*(H[0]+G[0]),.5*(H[1]+G[1]),.5*(H[2]+G[2])],Y=[.5*(X[0]+F[0]),.5*(X[1]+F[1]),.5*(X[2]+F[2])],$=[.5*(P[0]+X[0]),.5*(P[1]+X[1]),.5*(P[2]+X[2])],q=[.5*(P[0]+F[0]),.5*(P[1]+F[1]),.5*(P[2]+F[2])],K=[.5*(B[0]+C[0]),.5*(B[1]+C[1]),.5*(B[2]+C[2])],Z=[.5*(D[0]+C[0]),.5*(D[1]+C[1]),.5*(D[2]+C[2])],Q=[.5*(B[0]+D[0]),.5*(B[1]+D[1]),.5*(B[2]+D[2])],J=[f,V,N,H,[.5*(I[0]+V[0]),.5*(I[1]+V[1]),.5*(I[2]+V[2])],D,j,W,Z,Q],tt=[j,G,k,_,[.5*(U[0]+S[0]),.5*(U[1]+S[1]),.5*(U[2]+S[2])],Y,w,S,F,q],et=[Q,K,B,$,[.5*(R[0]+y[0]),.5*(R[1]+y[1]),.5*(R[2]+y[2])],R,q,P,E,b],it=[q,$,Y,K,[.25*(A[0]+L[0]+O[0]+g[0]),.25*(A[1]+L[1]+O[1]+g[1]),.25*(A[2]+L[2]+O[2]+g[2])],k,Q,Z,W,j],nt=this.normal(j,k,Y,q,$,K,Q),st=this.normal(q,$,K,Q,Z,W,j),rt=this.normal(Q,Z,W,j,k,Y,q),at=this.Epsilon,ht=[.5*(r[0]+a[0]),.5*(r[1]+a[1]),.5*(r[2]+a[2])];if(!h)if(h=te(w,M,T,b)<this.res2){let t=jt(this.sumdifferential(it[0],it[2],it[5],it[9],it[1],it[3],it[6]));ht=[ht[0]-at*t[0],ht[1]-at*t[1],ht[2]-at*t[2]]}else ht=q;let ot=[.5*(a[0]+s[0]),.5*(a[1]+s[1]),.5*(a[2]+s[2])];if(!o)if(o=te(f,p,x,b)<this.res2){let t=jt(this.sumdifferential(it[6],it[3],it[1],it[0],it[7],it[8],it[9]));ot=[ot[0]-at*t[0],ot[1]-at*t[1],ot[2]-at*t[2]]}else ot=Q;let lt=[.5*(s[0]+r[0]),.5*(s[1]+r[1]),.5*(s[2]+r[2])];if(!l)if(l=te(f,u,v,w)<this.res2){let t=jt(this.sumdifferential(it[9],it[8],it[7],it[6],it[5],it[2],it[0]));lt=[lt[0]-at*t[0],lt[1]-at*t[1],lt[2]-at*t[2]]}else lt=j;if(c){let t=Array(4),f=Array(4),u=Array(4);for(let e=0;e<4;++e)t[e]=.5*(d[e]+m[e]),f[e]=.5*(m[e]+c[e]),u[e]=.5*(c[e]+d[e]);let p=this.data.Vertex(ht,nt,t),v=this.data.Vertex(ot,st,f),g=this.data.Vertex(lt,rt,u);this.Render3(J,e,g,v,s,lt,ot,!1,o,l,c,u,f),this.Render3(tt,g,i,p,lt,r,ht,h,!1,l,u,d,t),this.Render3(et,v,p,n,ot,ht,a,h,o,!1,f,t,m),this.Render3(it,p,v,g,ht,ot,lt,!1,!1,!1,t,f,u)}else{let t=this.vertex(ht,nt),c=this.vertex(ot,st),d=this.vertex(lt,rt);this.Render3(J,e,d,c,s,lt,ot,!1,o,l),this.Render3(tt,d,i,t,lt,r,ht,h,!1,l),this.Render3(et,c,t,n,ot,ht,a,h,o,!1),this.Render3(it,t,c,d,ht,ot,lt,!1,!1,!1)}}}Distance(t){let e=t[0],i=t[3],n=t[12],s=t[15],r=ee(e,n,i,s);r=Math.max(r,te(e,t[4],t[8],n)),r=Math.max(r,te(t[1],t[5],t[9],t[13])),r=Math.max(r,te(i,t[7],t[11],s)),r=Math.max(r,te(t[2],t[6],t[10],t[14]));let a=ee(e,i,n,s);return a=Math.max(a,te(e,t[1],t[2],i)),a=Math.max(a,te(t[4],t[5],t[6],t[7])),a=Math.max(a,te(t[8],t[9],t[10],t[11])),a=Math.max(a,te(n,t[13],t[14],s)),[r,a]}Distance3(t){let e=t[0],i=t[4],n=t[6],s=t[9],r=Yt([(e[0]+n[0]+s[0])*T-i[0],(e[1]+n[1]+s[1])*T-i[1],(e[2]+n[2]+s[2])*T-i[2]]);return r=Math.max(r,te(e,t[1],t[3],n)),r=Math.max(r,te(e,t[2],t[5],s)),Math.max(r,te(n,t[7],t[8],s))}differential(t,e,i,n){let s=[3*(e[0]-t[0]),3*(e[1]-t[1]),3*(e[2]-t[2])];return Yt(s)>this.epsilon?s:(s=Qt(t,e,i),Yt(s)>this.epsilon?s:Jt(t,e,i,n))}sumdifferential(t,e,i,n,s,r,a){let h=this.differential(t,e,i,n),o=this.differential(t,s,r,a);return[h[0]+o[0],h[1]+o[1],h[2]+o[2]]}normal(t,e,i,n,s,r,a){let h=3*(s[0]-n[0]),o=3*(s[1]-n[1]),l=3*(s[2]-n[2]),c=3*(i[0]-n[0]),d=3*(i[1]-n[1]),m=3*(i[2]-n[2]),f=[o*m-l*d,l*c-h*m,h*d-o*c];if(Yt(f)>this.epsilon)return f;let u=[c,d,m],p=[h,o,l],v=Qt(n,i,e),g=Qt(n,s,r),x=qt(g,u),w=qt(p,v);if(f=[x[0]+w[0],x[1]+w[1],x[2]+w[2]],Yt(f)>this.epsilon)return f;let M=Jt(n,i,e,t),T=Jt(n,s,r,a);x=qt(p,M),w=qt(T,u);let b=qt(g,v);return f=[x[0]+w[0]+b[0],x[1]+w[1]+b[1],x[2]+w[2]+b[2]],Yt(f)>this.epsilon?f:(x=qt(T,v),w=qt(g,M),f=[x[0]+w[0],x[1]+w[1],x[2]+w[2]],Yt(f)>this.epsilon?f:qt(T,M))}}function Lt(t,e,i,n){return[n-t+3*(e-i),2*(t+i)-4*e,e-t]}function It(t){return 0<=t&&t<=1}class Nt{constructor(t,e,i){const n=1e3*Number.EPSILON,s=n*n;if(Math.abs(t)<=n*Math.abs(e)+s*Math.abs(i))Math.abs(e)>n*Math.abs(i)?(this.roots=1,this.t1=-i/e):0==i?(this.roots=1,this.t1=0):this.roots=0;else{let s=.5*e/t,r=e*s;if(Math.abs(r)<=n*Math.abs(i)){let e=-i/t;e>=0?(this.roots=2,this.t2=Math.sqrt(e),this.t1=-this.t2):this.roots=0}else{let t=-2*i/r;if(t>-1){this.roots=2;let e=s*function(t){return t/(Math.sqrt(1+t)+1)}(t),i=-e-2*s;i<=e?(this.t1=i,this.t2=e):(this.t1=e,this.t2=i)}else-1==t?(this.roots=1,this.t1=this.t2=-s):this.roots=0}}}}class Ut extends Et{constructor(t,e,i,n=null,s=null){if(super(),this.controlpoints=t,this.CenterIndex=e,this.MaterialIndex=i,n&&s)this.Min=n,this.Max=s;else{let t=this.Bounds(this.controlpoints);this.Min=t[0],this.Max=t[1]}}Bounds(t){let e=Array(3),i=Array(3),n=t.length,s=Array(n);for(let r=0;r<3;++r){for(let e=0;e<n;++e)s[e]=t[e][r];let a,h;if(a=h=s[0],4==n){a=Math.min(a,s[3]),h=Math.max(h,s[3]);let t=Lt(s[0],s[1],s[2],s[3]),e=new Nt(t[0],t[1],t[2]);if(0!=e.roots&&It(e.t1)){let t=Kt(s[0],s[1],s[2],s[3],e.t1);a=Math.min(a,t),h=Math.max(h,t)}if(2==e.roots&&It(e.t2)){let t=Kt(s[0],s[1],s[2],s[3],e.t2);a=Math.min(a,t),h=Math.max(h,t)}}else{let t=s[1];a=Math.min(a,t),h=Math.max(h,t)}e[r]=a,i[r]=h}return[[e[0],e[1],e[2]],[i[0],i[1],i[2]]]}setMaterialIndex(){this.setMaterial(D,Ce)}processLine(t){let e=t[0],i=t[1];if(!this.offscreen([e,i])){let t=[0,0,1];this.data.indices.push(this.data.vertex(e,t)),this.data.indices.push(this.data.vertex(i,t)),this.append()}}process(t){if(2==t.length)return this.processLine(t);let e=t[0],i=t[1],n=t[2],s=t[3],r=this.normal(Zt(e,i),Qt(e,i,n)),a=this.normal(Zt(n,s),Qt(s,n,i)),h=this.data.vertex(e,r),o=this.data.vertex(s,a);this.Render(t,h,o),this.data.indices.length>0&&this.append()}append(){D.append(this.data)}notRendered(){D.rendered=!1}Render(t,e,i){let n=t[0],s=t[1],r=t[2],a=t[3];if(te(n,s,r,a)<this.res2)this.offscreen([n,a])||(this.data.indices.push(e),this.data.indices.push(i));else{if(this.offscreen(t))return;let h=[.5*(n[0]+s[0]),.5*(n[1]+s[1]),.5*(n[2]+s[2])],o=[.5*(s[0]+r[0]),.5*(s[1]+r[1]),.5*(s[2]+r[2])],l=[.5*(r[0]+a[0]),.5*(r[1]+a[1]),.5*(r[2]+a[2])],c=[.5*(h[0]+o[0]),.5*(h[1]+o[1]),.5*(h[2]+o[2])],d=[.5*(o[0]+l[0]),.5*(o[1]+l[1]),.5*(o[2]+l[2])],m=[.5*(c[0]+d[0]),.5*(c[1]+d[1]),.5*(c[2]+d[2])],f=[n,h,c,m],u=[m,d,l,a],p=this.normal(function(t,e,i,n){return[i[0]+n[0]-t[0]-e[0],i[1]+n[1]-t[1]-e[1],i[2]+n[2]-t[2]-e[2]]}(n,s,r,a),function(t,e,i,n){return[3*t[0]-5*e[0]+i[0]+n[0],3*t[1]-5*e[1]+i[1]+n[1],3*t[2]-5*e[2]+i[2]+n[2]]}(n,s,r,a)),v=this.data.vertex(m,p);this.Render(f,e,v),this.Render(u,v,i)}}normal(t,e){let i=$t(t,t),n=$t(t,e);return[i*e[0]-n*t[0],i*e[1]-n*t[1],i*e[2]-n*t[2]]}}class St extends Et{constructor(t,e,i){super(),this.controlpoint=t,this.width=e,this.MaterialIndex=i,this.CenterIndex=0,this.Min=t,this.Max=t}setMaterialIndex(){this.setMaterial(P,De)}process(t){this.data.indices.push(this.data.vertex0(this.controlpoint,this.width)),this.append()}append(){P.append(this.data)}notRendered(){P.rendered=!1}}class Vt extends Et{constructor(t,e){super(),this.CenterIndex=t,this.MaterialIndex=e,this.transparent=!1;const i=window;this.controlpoints=i.Positions,this.Normals=i.Normals,this.Colors=i.Colors,this.Indices=i.Indices,this.transparent=x[this.MaterialIndex].diffuse[3]<1,this.Min=this.Bounds(this.controlpoints,Math.min),this.Max=this.Bounds(this.controlpoints,Math.max)}Bounds(t,e){let i=Array(3),n=t.length,s=Array(n);for(let r=0;r<3;++r){for(let e=0;e<n;++e)s[e]=t[e][r];i[r]=At(s,e)}return[i[0],i[1],i[2]]}setMaterialIndex(){this.transparent?this.setMaterial(z,He):this.setMaterial(X,Xe)}process(t){this.data.vertices.length=6*t.length,H=this.Colors.length>0?-1-H:1+H;for(let e=0,i=this.Indices.length;e<i;++e){let i=this.Indices[e],n=i[0],s=t[n[0]],r=t[n[1]],a=t[n[2]],h=!this.offscreen([s,r,a]),o=i.length>1?i[1]:n;if(o&&0!=o.length||(o=n),this.Colors.length>0){let t=i.length>2?i[2]:n;t&&0!=t.length||(t=n);let e=this.Colors[t[0]],l=this.Colors[t[1]],c=this.Colors[t[2]];this.transparent=this.transparent||e[3]+l[3]+c[3]<3,0==et?(this.data.iVertex(n[0],s,this.Normals[o[0]],h,e),this.data.iVertex(n[1],r,this.Normals[o[1]],h,l),this.data.iVertex(n[2],a,this.Normals[o[2]],h,c)):(this.data.iVertex(n[0],s,this.Normals[o[0]],h,e),this.data.iVertex(n[1],r,this.Normals[o[1]],h,l),this.data.iVertex(n[1],r,this.Normals[o[1]],h,l),this.data.iVertex(n[2],a,this.Normals[o[2]],h,c),this.data.iVertex(n[2],a,this.Normals[o[2]],h,c),this.data.iVertex(n[0],s,this.Normals[o[0]],h,e))}else 0==et?(this.data.iVertex(n[0],s,this.Normals[o[0]],h),this.data.iVertex(n[1],r,this.Normals[o[1]],h),this.data.iVertex(n[2],a,this.Normals[o[2]],h)):(this.data.iVertex(n[0],s,this.Normals[o[0]],h),this.data.iVertex(n[1],r,this.Normals[o[1]],h),this.data.iVertex(n[1],r,this.Normals[o[1]],h),this.data.iVertex(n[2],a,this.Normals[o[2]],h),this.data.iVertex(n[2],a,this.Normals[o[2]],h),this.data.iVertex(n[0],s,this.Normals[o[0]],h))}this.data.nvertices=t.length,this.data.indices.length>0&&this.append()}append(){this.transparent?z.append(this.data):X.append(this.data)}notRendered(){this.transparent?z.rendered=!1:X.rendered=!1}}function Ot(){S=-Math.tan(.5*o.angleOfView)*o.maxBound[2],Z.x=Z.y=0,Z.z=.5*(o.minBound[2]+o.maxBound[2]),y=A=o.zoom0,J.zmin=o.minBound[2],J.zmax=o.maxBound[2],Q.x=Q.y=0,ke(),tt=!0,We()}function _t(){return window.top.asyWebApplication}function Bt(t){window.parent.asyProjection=t}function Pt(){var t;n(G),Ot(),null===(t=_t())||void 0===t||t.setProjection(""),Bt(!1)}let Dt=0,Ct=1,Ft=2,zt=3,Xt=4;function Ht(t=[]){let e=wt(l,"#ifdef WEBGL2\n#define IN in\n#define OUT out\n#else\n#define IN attribute\n#define OUT varying\n#endif\n\nIN vec3 position;\n#ifdef WIDTH\nIN float width;\n#endif\n#ifdef NORMAL\nIN vec3 normal;\n#endif\n\nIN float materialIndex;\n\n#ifdef WEBGL2\nflat out int MaterialIndex;\n#ifdef COLOR\nOUT vec4 Color;\n#endif\n\n#else\nOUT vec4 diffuse;\nOUT vec3 specular;\nOUT float roughness,metallic,fresnel0;\nOUT vec4 emissive;\n\nstruct Material {\n  vec4 diffuse,emissive,specular;\n  vec4 parameters;\n};\n\nuniform Material Materials[Nmaterials];\n#endif\n\n#ifdef COLOR\nIN vec4 color;\n#endif\n\nuniform bool orthographic;\nuniform mat3 normMat;\nuniform mat4 viewMat;\nuniform mat4 projViewMat;\n\n#ifdef NORMAL\nOUT vec3 ViewPosition;\nOUT vec3 Normal;\n#endif\n\nvoid main(void)\n{\n  vec4 v=vec4(position,1.0);\n  gl_Position=projViewMat*v;\n\n#ifdef NORMAL\n  ViewPosition=orthographic ? vec3(0.0,0.0,-1.0) : (viewMat*v).xyz;\n  Normal=normalize(normal*normMat);\n#endif\n\n#ifdef WEBGL2\n  MaterialIndex=int(materialIndex);\n#ifdef COLOR\n  Color=color;\n#endif\n#else\n#ifdef NORMAL\n  Material m;\n#ifdef TRANSPARENT\n  m=Materials[int(abs(materialIndex))-1];\n  emissive=m.emissive;\n  if(materialIndex >= 0.0)\n    diffuse=m.diffuse;\n  else {\n    diffuse=color;\n#if nlights == 0\n    emissive += color;\n#endif\n  }\n#else\n  m=Materials[int(materialIndex)];\n  emissive=m.emissive;\n#ifdef COLOR\n  diffuse=color;\n#if nlights == 0\n    emissive += color;\n#endif\n#else\n  diffuse=m.diffuse;\n#endif // COLOR\n#endif // TRANSPARENT\n  specular=m.specular.rgb;\n  vec4 parameters=m.parameters;\n  roughness=1.0-parameters[0];\n  metallic=parameters[1];\n  fresnel0=parameters[2];\n#else\n  emissive=Materials[int(materialIndex)].emissive;\n#endif // NORMAL\n#endif // WEBGL2\n\n#ifdef WIDTH\n  gl_PointSize=width;\n#endif\n}\n",l.VERTEX_SHADER,t),i=wt(l,"#ifdef WEBGL2\n#define IN in\nout vec4 outValue;\n#define OUTVALUE outValue\n#else\n#define IN varying\n#define OUTVALUE gl_FragColor\n#endif\n\n#ifdef WEBGL2\nflat in int MaterialIndex;\n\nstruct Material {\n  vec4 diffuse,emissive,specular;\n  vec4 parameters;\n};\n\nuniform Material Materials[Nmaterials];\n\nvec4 diffuse;\nvec3 specular;\nfloat roughness,metallic,fresnel0;\nvec4 emissive;\n\n#ifdef COLOR\nin vec4 Color;\n#endif\n\n#else\nIN vec4 diffuse;\nIN vec3 specular;\nIN float roughness,metallic,fresnel0;\nIN vec4 emissive;\n#endif\n\n#ifdef NORMAL\n\nIN vec3 ViewPosition;\nIN vec3 Normal;\n\nvec3 normal;\n\nstruct Light {\n  vec3 direction;\n  vec3 color;\n};\n\nuniform Light Lights[Nlights];\n\n#ifdef USE_IBL\nuniform sampler2D reflBRDFSampler;\nuniform sampler2D diffuseSampler;\nuniform sampler2D reflImgSampler;\n\nconst float pi=acos(-1.0);\nconst float piInv=1.0/pi;\nconst float twopi=2.0*pi;\nconst float twopiInv=1.0/twopi;\n\n// (x,y,z) -> (r,theta,phi);\n// theta -> [0,pi]: colatitude\n// phi -> [-pi,pi]: longitude\nvec3 cart2sphere(vec3 cart)\n{\n  float x=cart.x;\n  float y=cart.z;\n  float z=cart.y;\n\n  float r=length(cart);\n  float theta=r > 0.0 ? acos(z/r) : 0.0;\n  float phi=atan(y,x);\n\n  return vec3(r,theta,phi);\n}\n\nvec2 normalizedAngle(vec3 cartVec)\n{\n  vec3 sphericalVec=cart2sphere(cartVec);\n  sphericalVec.y=sphericalVec.y*piInv;\n  sphericalVec.z=0.75-sphericalVec.z*twopiInv;\n  return sphericalVec.zy;\n}\n\nvec3 IBLColor(vec3 viewDir)\n{\n  vec3 IBLDiffuse=diffuse.rgb*texture(diffuseSampler,normalizedAngle(normal)).rgb;\n  vec3 reflectVec=normalize(reflect(-viewDir,normal));\n  vec2 reflCoord=normalizedAngle(reflectVec);\n  vec3 IBLRefl=textureLod(reflImgSampler,reflCoord,roughness*ROUGHNESS_STEP_COUNT).rgb;\n  vec2 IBLbrdf=texture(reflBRDFSampler,vec2(dot(normal,viewDir),roughness)).rg;\n  float specularMultiplier=fresnel0*IBLbrdf.x+IBLbrdf.y;\n  vec3 dielectric=IBLDiffuse+specularMultiplier*IBLRefl;\n  vec3 metal=diffuse.rgb*IBLRefl;\n  return mix(dielectric,metal,metallic);\n}\n#else\nfloat Roughness2;\nfloat NDF_TRG(vec3 h)\n{\n  float ndoth=max(dot(normal,h),0.0);\n  float alpha2=Roughness2*Roughness2;\n  float denom=ndoth*ndoth*(alpha2-1.0)+1.0;\n  return denom != 0.0 ? alpha2/(denom*denom) : 0.0;\n}\n\nfloat GGX_Geom(vec3 v)\n{\n  float ndotv=max(dot(v,normal),0.0);\n  float ap=1.0+Roughness2;\n  float k=0.125*ap*ap;\n  return ndotv/((ndotv*(1.0-k))+k);\n}\n\nfloat Geom(vec3 v, vec3 l)\n{\n  return GGX_Geom(v)*GGX_Geom(l);\n}\n\nfloat Fresnel(vec3 h, vec3 v, float fresnel0)\n{\n  float a=1.0-max(dot(h,v),0.0);\n  float b=a*a;\n  return fresnel0+(1.0-fresnel0)*b*b*a;\n}\n\n// physical based shading using UE4 model.\nvec3 BRDF(vec3 viewDirection, vec3 lightDirection)\n{\n  vec3 lambertian=diffuse.rgb;\n  vec3 h=normalize(lightDirection+viewDirection);\n\n  float omegain=max(dot(viewDirection,normal),0.0);\n  float omegaln=max(dot(lightDirection,normal),0.0);\n\n  float D=NDF_TRG(h);\n  float G=Geom(viewDirection,lightDirection);\n  float F=Fresnel(h,viewDirection,fresnel0);\n\n  float denom=4.0*omegain*omegaln;\n  float rawReflectance=denom > 0.0 ? (D*G)/denom : 0.0;\n\n  vec3 dielectric=mix(lambertian,rawReflectance*specular,F);\n  vec3 metal=rawReflectance*diffuse.rgb;\n\n  return mix(dielectric,metal,metallic);\n}\n#endif\n\n#endif\n\nvoid main(void)\n{\n#ifdef WEBGL2\n#ifdef NORMAL\n  Material m;\n#ifdef TRANSPARENT\n  m=Materials[abs(MaterialIndex)-1];\n  emissive=m.emissive;\n  if(MaterialIndex >= 0)\n    diffuse=m.diffuse;\n  else {\n    diffuse=Color;\n#if nlights == 0\n    emissive += Color;\n#endif\n  }\n#else\n  m=Materials[MaterialIndex];\n  emissive=m.emissive;\n#ifdef COLOR\n  diffuse=Color;\n#if nlights == 0\n    emissive += Color;\n#endif\n#else\n  diffuse=m.diffuse;\n#endif // COLOR\n#endif // TRANSPARENT\n  specular=m.specular.rgb;\n  vec4 parameters=m.parameters;\n  roughness=1.0-parameters[0];\n  metallic=parameters[1];\n  fresnel0=parameters[2];\n#else\n  emissive=Materials[MaterialIndex].emissive;\n#endif // NORMAL\n#endif // WEBGL2\n\n#if defined(NORMAL) && nlights > 0\n  normal=normalize(Normal);\n  normal=gl_FrontFacing ? normal : -normal;\n  vec3 viewDir=-normalize(ViewPosition);\n\nvec3 color;\n#ifdef USE_IBL\n  color=IBLColor(viewDir);\n#else\n  Roughness2=roughness*roughness;\n  color=emissive.rgb;\n  for(int i=0; i < nlights; ++i) {\n    Light Li=Lights[i];\n    vec3 L=Li.direction;\n    float cosTheta=max(dot(normal,L),0.0);\n    vec3 radiance=cosTheta*Li.color;\n    color += BRDF(viewDir,L)*radiance;\n  }\n#endif\n  OUTVALUE=vec4(color,diffuse.a);\n#else\n  OUTVALUE=emissive;\n#endif\n}\n",l.FRAGMENT_SHADER,t),n=l.createProgram();return l.attachShader(n,e),l.attachShader(n,i),l.bindAttribLocation(n,Dt,"position"),l.bindAttribLocation(n,Ct,"normal"),l.bindAttribLocation(n,Ft,"materialIndex"),l.bindAttribLocation(n,zt,"color"),l.bindAttribLocation(n,Xt,"width"),l.linkProgram(n),l.getProgramParameter(n,l.LINK_STATUS)||alert("Could not initialize shaders"),n}class Gt{constructor(t,e,i,n){this.m0=.5*(t+e);const s=.5*(e+i);this.m2=.5*(i+n),this.m3=.5*(this.m0+s),this.m4=.5*(s+this.m2),this.m5=.5*(this.m3+this.m4)}}class Wt{constructor(t,e,i,n){this.m0=[.5*(t[0]+e[0]),.5*(t[1]+e[1]),.5*(t[2]+e[2])];const s=.5*(e[0]+i[0]),r=.5*(e[1]+i[1]),a=.5*(e[2]+i[2]);this.m2=[.5*(i[0]+n[0]),.5*(i[1]+n[1]),.5*(i[2]+n[2])],this.m3=[.5*(this.m0[0]+s),.5*(this.m0[1]+r),.5*(this.m0[2]+a)],this.m4=[.5*(s+this.m2[0]),.5*(r+this.m2[1]),.5*(a+this.m2[2])],this.m5=[.5*(this.m3[0]+this.m4[0]),.5*(this.m3[1]+this.m4[1]),.5*(this.m3[2]+this.m4[2])]}}class kt{constructor(t){this.l003=t[0];const e=t[1],i=t[2],n=t[3],s=t[4],r=t[5];this.r300=t[6];const a=t[7],h=t[8];this.u030=t[9],this.u021=.5*(this.u030+r),this.u120=.5*(this.u030+h);const o=.5*(r+i),l=.5*(h+s),c=.5*(h+a),d=.5*(i+s);this.l012=.5*(i+this.l003);const m=.5*(s+n);this.r210=.5*(a+this.r300),this.l102=.5*(this.l003+e);const f=.5*(e+n);this.r201=.5*(n+this.r300),this.u012=.5*(this.u021+o),this.u210=.5*(this.u120+c),this.l021=.5*(o+this.l012);const u=.5*l+.25*(s+e);this.r120=.5*(c+this.r210);const p=.5*d+.25*(s+a),v=.25*(r+s)+.5*m;this.l201=.5*(this.l102+f),this.r102=.5*(f+this.r201),this.l210=.5*(p+this.l201),this.r012=.5*(p+this.r102),this.l300=.5*(this.l201+this.r102),this.r021=.5*(v+this.r120),this.u201=.5*(this.u210+v),this.r030=.5*(this.u210+this.r120),this.u102=.5*(this.u012+u),this.l120=.5*(this.l021+u),this.l030=.5*(this.u012+this.l021),this.l111=.5*(d+this.l102),this.r111=.5*(m+this.r210),this.u111=.5*(this.u021+l),this.c111=.25*(o+c+f+s)}}function jt(t){const e=1/(Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])||1);return[t[0]*e,t[1]*e,t[2]*e]}function Yt(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function $t(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qt(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Kt(t,e,i,n,s){let r=1-s,a=r*r;return a*r*t+s*(3*(a*e+s*r*i)+s*s*n)}function Zt(t,e){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function Qt(t,e,i){return[3*(t[0]+i[0])-6*e[0],3*(t[1]+i[1])-6*e[1],3*(t[2]+i[2])-6*e[2]]}function Jt(t,e,i,n){return[n[0]-t[0]+3*(e[0]-i[0]),n[1]-t[1]+3*(e[1]-i[1]),n[2]-t[2]+3*(e[2]-i[2])]}function te(t,e,i,n){let s=[T*(n[0]-t[0]),T*(n[1]-t[1]),T*(n[2]-t[2])];return Math.max(Yt([e[0]-s[0]-t[0],e[1]-s[1]-t[1],e[2]-s[2]-t[2]]),Yt([n[0]-s[0]-i[0],n[1]-s[1]-i[1],n[2]-s[2]-i[2]]))}function ee(t,e,i,n){const s=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],r=[n[0]-i[0],n[1]-i[1],n[2]-i[2]];return Math.max(Yt(qt(s,jt(r))),Yt(qt(r,jt(s))))/9}function ie(t){return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0],t[4][0],t[5][0],t[6][0],t[7][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1],t[4][1],t[5][1],t[6][1],t[7][1]),Math.min(t[0][2],t[1][2],t[2][2],t[3][2],t[4][2],t[5][2],t[6][2],t[7][2])]}function ne(t){return[Math.max(t[0][0],t[1][0],t[2][0],t[3][0],t[4][0],t[5][0],t[6][0],t[7][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1],t[4][1],t[5][1],t[6][1],t[7][1]),Math.max(t[0][2],t[1][2],t[2][2],t[3][2],t[4][2],t[5][2],t[6][2],t[7][2])]}function se(t){Te||be(),it=!0,nt=t.clientX,st=t.clientY}let re,ae,he=!1;function oe(t){return Math.hypot(t[0].pageX-t[1].pageX,t[0].pageY-t[1].pageY)}let le=null;function ce(t){t.preventDefault(),Te||be();let e=t.targetTouches;Ne=Ue=he=!1,Ie||(1!=e.length||it||(ae=(new Date).getTime(),le=e[0].identifier,nt=e[0].pageX,st=e[0].pageY),2!=e.length||it||(le=e[0].identifier,re=oe(e),he=!0))}function de(t){it=!1}function me(e,i,n,r,a){if(e==n&&i==r)return;const{angle:h,axis:o}=function(t,e){const i=xe(t),n=xe(e),s=$t(i,n);return{angle:s>1?0:s<-1?b:Math.acos(s),axis:jt(qt(i,n))}}([e,-i],[n,-r]);!function(e,i,n){var s,r,a,h=n[0],o=n[1],l=n[2],c=Math.hypot(h,o,l);c<t||(h*=c=1/c,o*=c,l*=c,s=Math.sin(i),a=1-(r=Math.cos(i)),e[0]=h*h*a+r,e[1]=o*h*a+l*s,e[2]=l*h*a-o*s,e[3]=0,e[4]=h*o*a-l*s,e[5]=o*o*a+r,e[6]=l*o*a+h*s,e[7]=0,e[8]=h*l*a+o*s,e[9]=o*l*a-h*s,e[10]=l*l*a+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}(K,2*a*O*h/A,o),s(G,K,G)}function fe(t,e,i,n){let s=1/A;Q.x+=(i-t)*s*u,Q.y-=(n-e)*s*p}function ue(t,e,i,n){o.orthographic?fe(t,e,i,n):(Z.x+=(i-t)*(J.xmax-J.xmin),Z.y-=(n-e)*(J.ymax-J.ymin))}function pe(){var t,e;t=k,e=G,function(t,e){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1}(K,[Z.x,Z.y,Z.z]),function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],a=e[4],h=e[5],o=e[6],l=e[7],c=e[8],d=e[9],m=e[10],f=e[11],u=e[12],p=e[13],v=e[14],g=e[15],x=i*h-n*a,w=i*o-s*a,M=i*l-r*a,T=n*o-s*h,b=n*l-r*h,R=s*l-r*o,E=c*p-d*u,A=c*v-m*u,y=c*g-f*u,L=d*v-m*p,I=d*g-f*p,N=m*g-f*v,U=x*N-w*I+M*L+T*y-b*A+R*E;U&&(U=1/U,t[0]=(h*N-o*I+l*L)*U,t[1]=(s*I-n*N-r*L)*U,t[2]=(p*R-v*b+g*T)*U,t[3]=(m*b-d*R-f*T)*U,t[4]=(o*y-a*N-l*A)*U,t[5]=(i*N-s*y+r*A)*U,t[6]=(v*M-u*R-g*w)*U,t[7]=(c*R-m*M+f*w)*U,t[8]=(a*I-h*y+l*E)*U,t[9]=(n*y-i*I-r*E)*U,t[10]=(u*b-p*M+g*x)*U,t[11]=(d*M-c*b-f*x)*U,t[12]=(h*A-a*L-o*E)*U,t[13]=(i*L-n*A+s*E)*U,t[14]=(p*w-u*T-v*x)*U,t[15]=(c*T-d*w+m*x)*U)}(q,K),s(t,e,q),s(t,K,t),function(t,e,i){var n,s,r,a,h,o,l,c,d,m,f,u,p=i[0],v=i[1],g=i[2];e===t?(t[12]=e[0]*p+e[4]*v+e[8]*g+e[12],t[13]=e[1]*p+e[5]*v+e[9]*g+e[13],t[14]=e[2]*p+e[6]*v+e[10]*g+e[14],t[15]=e[3]*p+e[7]*v+e[11]*g+e[15]):(n=e[0],s=e[1],r=e[2],a=e[3],h=e[4],o=e[5],l=e[6],c=e[7],d=e[8],m=e[9],f=e[10],u=e[11],t[0]=n,t[1]=s,t[2]=r,t[3]=a,t[4]=h,t[5]=o,t[6]=l,t[7]=c,t[8]=d,t[9]=m,t[10]=f,t[11]=u,t[12]=n*p+h*v+d*g+e[12],t[13]=s*p+o*v+m*g+e[13],t[14]=r*p+l*v+f*g+e[14],t[15]=a*p+c*v+u*g+e[15])}(k,k,[Z.x,Z.y,0]),function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10]}($,k),function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],a=e[4],h=e[5],o=e[6],l=e[7],c=e[8],d=c*a-h*l,m=-c*r+h*o,f=l*r-a*o,u=i*d+n*m+s*f;u&&(u=1/u,t[0]=d*u,t[1]=(-c*n+s*l)*u,t[2]=(h*n-s*a)*u,t[3]=m*u,t[4]=(c*i-s*o)*u,t[5]=(-h*i+s*r)*u,t[6]=f*u,t[7]=(-l*i+n*o)*u,t[8]=(a*i-n*r)*u)}(Y,$),s(j,W,k)}function ve(){let t=Math.sqrt(Number.MAX_VALUE),e=1/t;A<=e&&(A=e),A>=t&&(A=t),(1.5*A<y||A>1.5*y)&&(tt=!0,y=A)}function ge(t){let e=o.zoomStep*p*t;const i=Math.log(.1*Number.MAX_VALUE)/Math.log(o.zoomFactor);Math.abs(e)<i&&(A*=o.zoomFactor**e,ve())}function xe(t){let e=t[0],i=t[1],n=Math.hypot(e,i);if(n>1){const t=1/n;e*=t,i*=t}return[e,i,Math.sqrt(Math.max(1-i*i-e*e,0))]}function we(t,e,i,n){ge(e-n)}function Me(t,e,i,n=1){let s;switch(i){case 1:s=me;break;case 2:s=fe;break;case 3:s=we;break;case 4:s=ue;break;default:s=(t,e,i,n)=>{}}s((nt-u)/u,(st-p)/p,(t-u)/u,(e-p)/p,n),nt=t,st=e,ke(),We()}let Te=0;function be(){Te=1,o.canvas.addEventListener("wheel",ye,!1)}function Re(){let t,e,i;[t,e,i]=function(){let t=Array(3),e=Array(3),i=Array(3),n=Z.x,s=Z.y,r=.5*(J.zmin+J.zmax);for(let a=0;a<3;++a){let h=0,l=0,c=0,d=4*a;for(let t=0;t<4;++t){let e=4*t,i=G[e],a=G[e+1],m=G[e+2],f=G[e+3],u=o.Transform[d+t];h+=u*(f-n*i-s*a-r*m),c+=u*a,l+=u*(f-n*i-s*a)}t[a]=h,e[a]=c,i[a]=l}return[t,e,i]}();let n=o.orthographic?"  orthographic(":"  perspective(",s="".padStart(n.length),r="currentprojection=\n"+n+"camera=("+t+"),\n"+s+"up=("+e+"),\n"+s+"target=("+i+"),\n"+s+"zoom="+A*o.initialZoom/o.zoom0;return o.orthographic||(r+=",\n"+s+"angle="+2*Math.atan(Math.tan(.5*o.angleOfView)/A)/R),0==L&&0==I||(r+=",\n"+s+"viewportshift=("+L+","+I+")"),o.orthographic||(r+=",\n"+s+"autoadjust=false"),r+=");\n",Bt(!0),r}function Ee(e){if(Te||be(),o.embedded&&Te&&27==e.keyCode)return Te=0,void o.canvas.removeEventListener("wheel",ye,!1);let i=null;switch(e.key){case"x":i=[1,0,0];break;case"y":i=[0,1,0];break;case"z":i=[0,0,1];break;case"h":Pt();break;case"m":++et,3==et&&(et=0),2!=et&&(o.embedded||pt(),ut(o.ibl)),tt=!0,We();break;case"+":case"=":case">":A*=o.zoomFactor,Ae();break;case"-":case"_":case"<":A/=o.zoomFactor,Ae();break;case"c":_t()||prompt("Ctrl+c Enter to copy currentprojection to clipboard; then append to asy file:",Re())}null!==i&&(function(e,i,n,s){var r,a,h,o,l,c,d,m,f,u,p,v,g,x,w,M,T,b,R,E,A,y,L,I,N=s[0],U=s[1],S=s[2],V=Math.hypot(N,U,S);V<t||(N*=V=1/V,U*=V,S*=V,r=Math.sin(.1),h=1-(a=Math.cos(.1)),o=i[0],l=i[1],c=i[2],d=i[3],m=i[4],f=i[5],u=i[6],p=i[7],v=i[8],g=i[9],x=i[10],w=i[11],M=N*N*h+a,T=U*N*h+S*r,b=S*N*h-U*r,R=N*U*h-S*r,E=U*U*h+a,A=S*U*h+N*r,y=N*S*h+U*r,L=U*S*h-N*r,I=S*S*h+a,e[0]=o*M+m*T+v*b,e[1]=l*M+f*T+g*b,e[2]=c*M+u*T+x*b,e[3]=d*M+p*T+w*b,e[4]=o*R+m*E+v*A,e[5]=l*R+f*E+g*A,e[6]=c*R+u*E+x*A,e[7]=d*R+p*E+w*A,e[8]=o*y+m*L+v*I,e[9]=l*y+f*L+g*I,e[10]=c*y+u*L+x*I,e[11]=d*y+p*L+w*I,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]))}(G,G,0,i),pe(),We())}function Ae(){ve(),ke(),We()}function ye(t){t.preventDefault(),t.deltaY<0?A*=o.zoomFactor:A/=o.zoomFactor,Ae()}function Le(t){if(!it)return;let e,i=t.clientX,n=t.clientY;e=t.getModifierState("Control")?2:t.getModifierState("Shift")?3:t.getModifierState("Alt")?4:1,Me(i,n,e)}let Ie=!1,Ne=!1,Ue=!1;function Se(t){if(t.preventDefault(),Ie)return;let e=t.targetTouches;if(!he&&1==e.length&&le==e[0].identifier){let t=e[0].pageX,i=e[0].pageY,n=t-nt,s=i-st,r=n*n+s*s<=o.shiftHoldDistance*o.shiftHoldDistance;r&&!Ne&&!Ue&&(new Date).getTime()-ae>o.shiftWaitTime&&(navigator.vibrate&&window.navigator.vibrate(o.vibrateTime),Ne=!0),Ne?Me(t,i,2):r||(Ue=!0,Me(e[0].pageX,e[0].pageY,1,.5))}if(he&&!Ne&&2==e.length&&le==e[0].identifier){let t=oe(e),i=t-re;Ie=!0,i*=o.zoomPinchFactor,i>o.zoomPinchCap&&(i=o.zoomPinchCap),i<-o.zoomPinchCap&&(i=-o.zoomPinchCap),ge(i/V),re=t,Ne=Ue=Ie=!1,ke(),We()}}let Ve,Oe,_e,Be,Pe=[];function De(){Tt(P,Ve),P.clear()}function Ce(){Tt(D,Oe),D.clear()}function Fe(){Tt(C,Oe),C.clear()}function ze(){Tt(F,_e),F.clear()}function Xe(){Tt(X,Be),X.rendered=!1,X.clear()}function He(){let t=z.indices;if(et>0)return Tt(z,Be,t),void z.clear();if(t.length>0){!function(t){let e=k[2],i=k[6],n=k[10];Pe.length=t.length;for(let s=0;s<t.length;++s){let r=6*s;Pe[s]=e*t[r]+i*t[r+1]+n*t[r+2]}}(z.vertices);const e=t.length/3,i=[...Array(e).keys()];i.sort(function(e,i){let n=3*e;const s=t[n],r=t[n+1],a=t[n+2];let h=3*i;const o=t[h],l=t[h+1],c=t[h+2];return Pe[s]+Pe[r]+Pe[a]<Pe[o]+Pe[l]+Pe[c]?-1:1});const n=Array(t.length);for(let s=0;s<e;++s){const e=3*i[s];n[3*s]=t[e],n[3*s+1]=t[e+1],n[3*s+2]=t[e+2]}l.depthMask(!1),Tt(z,Be,n),z.rendered=!1,l.depthMask(!0)}z.clear()}function Ge(){De(),Ce(),Fe(),ze(),Xe(),He(),requestAnimationFrame(Ge)}function We(){o.embedded&&(d.width=o.canvasWidth,d.height=o.canvasHeight,je()),l.clearColor(o.background[0],o.background[1],o.background[2],o.background[3]),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT);for(const t of v)t.render();Ge(),o.embedded&&(m.clearRect(0,0,o.canvasWidth,o.canvasHeight),m.drawImage(d,0,0)),0==et&&(tt=!1)}function ke(){var t;!function(t,e,i,n){let s=t/e;L=(i/t+o.viewportShift[0])*A,I=(n/e+o.viewportShift[1])*A;let r=1/A;if(o.orthographic){let t=o.maxBound[0]-o.minBound[0],e=o.maxBound[1]-o.minBound[1];if(t<e*s){let t=.5*e*s*r,i=2*t*L,n=e*r*I;J.xmin=-t-i,J.xmax=t-i,J.ymin=o.minBound[1]*r-n,J.ymax=o.maxBound[1]*r-n}else{let e=.5*t*r/s,i=t*r*L,n=2*e*I;J.xmin=o.minBound[0]*r-i,J.xmax=o.maxBound[0]*r-i,J.ymin=-e-n,J.ymax=e-n}}else{let t=S*r,e=t*s,i=2*e*L,n=2*t*I;J.xmin=-e-i,J.xmax=e-i,J.ymin=-t-n,J.ymax=t-n}}(o.canvasWidth,o.canvasHeight,Q.x,Q.y),(o.orthographic?a:r)(W,J.xmin,J.xmax,J.ymin,J.ymax,-J.zmax,-J.zmin),pe(),null===(t=_t())||void 0===t||t.setProjection(Re())}function je(){l.viewportWidth=o.canvasWidth,l.viewportHeight=o.canvasHeight,l.viewport(.5*(o.canvas.width-o.canvasWidth),.5*(o.canvas.height-o.canvasHeight),o.canvasWidth,o.canvasHeight),l.scissor(0,0,o.canvas.width,o.canvas.height)}function Ye(){var t;if(o.zoom0=o.initialZoom,""===(null===(t=_t())||void 0===t?void 0:t.getProjection())&&Bt(!1),o.absolute&&!o.embedded)o.canvasWidth=o.canvasWidth0*window.devicePixelRatio,o.canvasHeight=o.canvasHeight0*window.devicePixelRatio;else{let t=o.canvasWidth0/o.canvasHeight0;o.canvasWidth=Math.max(window.innerWidth-10,10),o.canvasHeight=Math.max(window.innerHeight-10,10),!o.orthographic&&!window.parent.asyProjection&&o.canvasWidth<o.canvasHeight*t&&(o.zoom0*=o.canvasWidth/(o.canvasHeight*t))}o.canvas.width=o.canvasWidth,o.canvas.height=o.canvasHeight,window.innerWidth,window.innerHeight;let e=1/o.zoom0;var i,n;o.viewportShift[0]*=e,o.viewportShift[1]*=e,i=o.canvasWidth,n=o.canvasHeight,i>N&&(i=N),n>U&&(n=U),Q.x*=i/o.canvasWidth,Q.y*=n/o.canvasHeight,o.canvasWidth=i,o.canvasHeight=n,o.embedded&&(o.canvas.width=d.width=o.canvasWidth,o.canvas.height=d.height=o.canvasHeight),V=Math.hypot(o.canvasWidth,o.canvasHeight),u=.5*o.canvas.width,p=.5*o.canvas.height,O=1+8*Math.hypot(o.viewportMargin[0],o.viewportMargin[1])/V,je(),ke(),tt=!0,Ot()}class $e{constructor(t,e=null){if(this.center=t,e){const t=e[0],i=e[1];this.ct=Math.cos(t),this.st=Math.sin(t),this.cp=Math.cos(i),this.sp=Math.sin(i)}}T0(t){return[t[0]+this.center[0],t[1]+this.center[1],t[2]+this.center[2]]}T(t){let e=t[0],i=t[1],n=t[2],s=e*this.ct+n*this.st;return[s*this.cp-i*this.sp+this.center[0],s*this.sp+i*this.cp+this.center[1],-e*this.st+n*this.ct+this.center[2]]}}function qe(t,e,i){let n=[t(e),t([e[0],e[1],i[2]]),t([e[0],i[1],e[2]]),t([e[0],i[1],i[2]]),t([i[0],e[1],e[2]]),t([i[0],e[1],i[2]]),t([i[0],i[1],e[2]]),t(i)];return[ie(n),ne(n)]}let Ke=4/3*(Math.sqrt(2)-1);async function Ze(t){return(await fetch(t)).arrayBuffer()}function Qe(t){return t.getBytes().filter((t,e)=>e%4!=3)}function Je(t,e,i=l.RGB16F){let n=t.width(),s=t.height(),r=l.createTexture();return l.activeTexture(l.TEXTURE0+e),l.bindTexture(l.TEXTURE_2D,r),l.pixelStorei(l.UNPACK_ALIGNMENT,1),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,i,n,s,0,l.RGB,l.FLOAT,Qe(t)),r}globalThis.window.webGLStart=function(){o.canvas=document.getElementById("Asymptote"),o.embedded=window.top.document!=document,xt(),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.enable(l.DEPTH_TEST),l.enable(l.SCISSOR_TEST),o.canvas.onmousedown=se,document.onmouseup=de,document.onmousemove=Le,o.canvas.onkeydown=Ee,o.embedded||be(),o.canvas.addEventListener("touchstart",ce,!1),o.canvas.addEventListener("touchend",de,!1),o.canvas.addEventListener("touchcancel",de,!1),o.canvas.addEventListener("touchleave",de,!1),o.canvas.addEventListener("touchmove",Se,!1),document.addEventListener("keydown",Ee,!1),o.canvasWidth0=o.canvasWidth,o.canvasHeight0=o.canvasHeight,n(G),0!=window.innerWidth&&0!=window.innerHeight&&Ye(),window.addEventListener("resize",Ye,!1),o.ibl&&(Module.onRuntimeInitialized=async()=>{await async function(){const t=o.imageURL+o.image+"/",e=[Ze(o.imageURL+"refl.exr").then(t=>{let e=new Module.EXRLoader(t);dt=Je(e,0)}),Ze(t+"diffuse.exr").then(t=>{let e=new Module.EXRLoader(t);ct=Je(e,1)})],i=[Ze(t+"refl0.exr")];for(let e=1;e<=8;++e)i.push(Ze(t+"refl"+e+"w.exr"));const n=Promise.all(i).then(t=>{let e=l.createTexture();l.activeTexture(l.TEXTURE0+2),l.pixelStorei(l.UNPACK_ALIGNMENT,1),l.bindTexture(l.TEXTURE_2D,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAX_LEVEL,t.length-1),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameterf(l.TEXTURE_2D,l.TEXTURE_MIN_LOD,0),l.texParameterf(l.TEXTURE_2D,l.TEXTURE_MAX_LOD,8);for(let e=0;e<t.length;++e){let i=new Module.EXRLoader(t[e]);l.texImage2D(l.TEXTURE_2D,e,l.RGB16F,i.width(),i.height(),0,l.RGB,l.FLOAT,Qe(i))}lt=e});e.push(n),await Promise.all(e)}(),o.embedded||pt(),ut(o.ibl),Ot()}),Pt()},globalThis.window.light=function(t,e){g.push(new ft(t,e))},globalThis.window.material=function(t,e,i,n,s,r){x.push(new mt(t,e,i,n,s,r))},globalThis.window.patch=function(t,e,i,n){v.push(new yt(t,e,i,n))},globalThis.window.curve=function(t,e,i){v.push(new Ut(t,e,i))},globalThis.window.pixel=function(t,e,i){v.push(new St(t,e,i))},globalThis.window.triangles=function(t,e){v.push(new Vt(t,e)),rt.length=0,at.length=0,ht.length=0,ot.length=0},globalThis.window.sphere=function(t,e,i,n,s){let r,a,h,o,l,c,d=.524670512339254,m=.595936986722291,f=.954967051233925,u=.0820155480083437,p=.996685028842544,g=.0549670512339254,x=.998880711874577,w=.0405017186586849,M=[[[1,0,0],[1,0,d],[m,0,f],[u,0,p],[1,Ke,0],[1,Ke,d],[m,Ke*m,f],[u,Ke*u,p],[Ke,1,0],[Ke,1,d],[Ke*m,m,f],[Ke*u,u,p],[0,1,0],[0,1,d],[0,m,f],[0,u,p]],[[u,0,p],[u,Ke*u,p],[g,0,x],[Ke*u,u,p],[w,w,1],[.05*Ke,0,1],[0,u,p],[0,g,x],[0,.05*Ke,1],[0,0,1]]],T=new $e(t,s);function b(t){let e=Array(t.length);for(let i=0;i<t.length;++i){let n=t[i];e[i]=l([r*n[0],a*n[1],h*n[2]])}return e}s?(o=1,c=0,l=T.T.bind(T)):(o=-1,c=-e,l=T.T0.bind(T));let R=qe(l,[-e,-e,c],[e,e,e]),E=R[0],A=R[1];for(let t=-1;t<=1;t+=2){r=t*e;for(let t=-1;t<=1;t+=2){a=t*e;for(let t=o;t<=1;t+=2){h=t*e;for(let t=0;t<2;++t)v.push(new yt(b(M[t]),i,n,null,E,A))}}}},globalThis.window.disk=function(t,e,i,n,s){let r=1-2*Ke/3,a=[[1,0,0],[1,-Ke,0],[Ke,-1,0],[0,-1,0],[1,Ke,0],[r,0,0],[0,-r,0],[-Ke,-1,0],[Ke,1,0],[0,r,0],[-r,0,0],[-1,-Ke,0],[0,1,0],[-Ke,1,0],[-1,Ke,0],[-1,0,0]],h=new $e(t,s),o=qe(h.T.bind(h),[-e,-e,0],[e,e,0]);v.push(new yt(function(t){let i=Array(t.length);for(let n=0;n<t.length;++n){let s=t[n];i[n]=h.T([e*s[0],e*s[1],0])}return i}(a),i,n,null,o[0],o[1]))},globalThis.window.cylinder=function(t,e,i,n,s,r,a){let h,o,l=[[1,0,0],[1,0,1/3],[1,0,2/3],[1,0,1],[1,Ke,0],[1,Ke,1/3],[1,Ke,2/3],[1,Ke,1],[Ke,1,0],[Ke,1,1/3],[Ke,1,2/3],[Ke,1,1],[0,1,0],[0,1,1/3],[0,1,2/3],[0,1,1]],c=new $e(t,r);function d(t){let e=Array(t.length);for(let n=0;n<t.length;++n){let s=t[n];e[n]=c.T([h*s[0],o*s[1],i*s[2]])}return e}let m=qe(c.T.bind(c),[-e,-e,0],[e,e,i]),f=m[0],u=m[1];for(let t=-1;t<=1;t+=2){h=t*e;for(let t=-1;t<=1;t+=2)o=t*e,v.push(new yt(d(l),n,s,null,f,u))}if(a){let e=c.T([0,0,i]);v.push(new Ut([t,e],n,s,t,e))}},globalThis.window.tube=function(t,e,i,n,s){let r=function(t,e,i,n,s){class r{constructor(t,e,i){this.p=t,this.r=e,this.t=i,this.s=qt(this.t,this.r)}}let a=Number.EPSILON*Math.max(Yt(t),Yt(e),Yt(i),Yt(n));function h(s){if(1==s){let s=[n[0]-i[0],n[1]-i[1],n[2]-i[2]];return Yt(s)>a?jt(s):(s=[2*i[0]-e[0]-n[0],2*i[1]-e[1]-n[1],2*i[2]-e[2]-n[2]],Yt(s)>a?jt(s):[n[0]-t[0]+3*(e[0]-i[0]),n[1]-t[1]+3*(e[1]-i[1]),n[2]-t[2]+3*(e[2]-i[2])])}let r=[n[0]-t[0]+3*(e[0]-i[0]),n[1]-t[1]+3*(e[1]-i[1]),n[2]-t[2]+3*(e[2]-i[2])],h=[2*(t[0]+i[0])-4*e[0],2*(t[1]+i[1])-4*e[1],2*(t[2]+i[2])-4*e[2]],o=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],l=s*s,c=[r[0]*l+h[0]*s+o[0],r[1]*l+h[1]*s+o[1],r[2]*l+h[2]*s+o[2]];return Yt(c)>a?jt(c):(l=2*s,c=[r[0]*l+h[0],r[1]*l+h[1],r[2]*l+h[2]],Yt(c)>a?jt(c):jt(r))}let o=Array(s.length),l=[e[0]-t[0],e[1]-t[1],e[2]-t[2]];Yt(l)<a&&(l=[t[0]-2*e[0]+i[0],t[1]-2*e[1]+i[1],t[2]-2*e[2]+i[2]],Yt(l)<a&&(l=[n[0]-t[0]+3*(e[0]-i[0]),n[1]-t[1]+3*(e[1]-i[1]),n[2]-t[2]+3*(e[2]-i[2])])),l=jt(l);let c=function(t){let e=qt(t,[0,1,0]),i=Number.EPSILON*Yt(t);return Yt(e)>i?jt(e):(e=qt(t,[0,0,1]),Yt(e)>i?jt(e):[1,0,0])}(l);o[0]=new r(t,c,l);for(let a=1;a<s.length;++a){let l=o[a-1],c=s[a],d=1-c,m=d*d,f=m*d,u=3*c;m*=u,d*=u*c;let p=c*c*c,v=[f*t[0]+m*e[0]+d*i[0]+p*n[0],f*t[1]+m*e[1]+d*i[1]+p*n[1],f*t[2]+m*e[2]+d*i[2]+p*n[2]],g=[v[0]-l.p[0],v[1]-l.p[1],v[2]-l.p[2]];if(0!=g[0]||0!=g[1]||0!=g[2]){let t=l.r,e=jt(g),i=l.t,n=$t(e,i),s=[i[0]-2*n*e[0],i[1]-2*n*e[1],i[2]-2*n*e[2]];i=h(c);let d=2*$t(e,t),m=[t[0]-d*e[0],t[1]-d*e[1],t[2]-d*e[2]],f=jt([i[0]-s[0],i[1]-s[1],i[2]-s[2]]),u=2*$t(f,m);m=[m[0]-u*f[0],m[1]-u*f[1],m[2]-u*f[2]],o[a]=new r(v,jt(m),jt(i))}else o[a]=o[a-1]}return o}(t[0],t[1],t[2],t[3],[0,1/3,2/3,1]),a=Ke*e,h=[[e,0],[e,a],[a,e],[0,e]];function o(e,s,a,o){let l=Array(16);for(let i=0;i<4;++i){let n=r[i],c=n.r[0],d=n.s[0],m=c*e+d*s,f=c*a+d*o;c=n.r[1],d=n.s[1];let u=c*e+d*s,p=c*a+d*o;c=n.r[2],d=n.s[2];let v=c*e+d*s,g=c*a+d*o,x=t[i],w=x[0];const M=x[1],T=x[2];for(let t=0;t<4;++t){let e=h[t],n=e[0],s=e[1];l[4*i+t]=[m*n+f*s+w,u*n+p*s+M,v*n+g*s+T]}}v.push(new yt(l,i,n))}o(1,0,0,1),o(0,-1,1,0),o(-1,0,0,-1),o(0,1,-1,0),s&&v.push(new Ut(t,i,n))},globalThis.window.Positions=rt,globalThis.window.Normals=at,globalThis.window.Colors=ht,globalThis.window.Indices=ot}()})();
